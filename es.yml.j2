---
- name: install es
  hosts: es
  vars:
     es_api_basic_auth_username : "{{ subutai.user_variables.es_api_basic_auth_username }}"
     es_api_basic_auth_password : "{{ subutai.user_variables.es_api_basic_auth_password }}"
  roles:
    - role: elastic.elasticsearch
      es_instance_name: "wp"

  post_tasks:
    - name: install nginx
      package:
       name: nginx
       state: present

    - name: delete default nginx conf
      file:
       state: absent
       path: /etc/nginx/sites-enabled/default

    - name: copy es nginx conf
      template:
       src: app.conf
       dest: /etc/nginx/sites-enabled/app.conf
       owner: root
       mode: "u=rw,g=r,o=r"

    - name: restart nginx
      service:
        name: nginx
        state: restarted
        
    - name: install analysis-icu
      shell: bash /usr/share/elasticsearch/bin/elasticsearch-plugin install analysis-icu
